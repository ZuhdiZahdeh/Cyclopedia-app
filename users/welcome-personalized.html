<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Welcome | KidCyclopedia</title>
  <link rel="stylesheet" href="../css/style.css">
  <script type="module">
    import { auth, db } from './firebase-config.js';
    import { onAuthStateChanged } from 'firebase/auth';
    import { doc, getDoc } from 'firebase/firestore';

    const messages = {
      en: {
        Beginner: {
          greet: "ðŸ‘‹ Welcome to your first adventure!",
          msg: "You're starting as a Beginner. Ready to explore?"
        },
        Intermediate: {
          greet: "ðŸ‘‹ Welcome back, Explorer!",
          msg: "You're progressing well! Keep going!"
        },
        Advanced: {
          greet: "ðŸ‘‹ Welcome, Master!",
          msg: "You're reaching the top. Challenge yourself even more!"
        }
      },
      ar: {
        Beginner: {
          greet: "ðŸ‘‹ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù…ØºØ§Ù…Ø±ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰!",
          msg: "Ø£Ù†Øª ØªØ¨Ø¯Ø£ ÙƒÙ…Ø¨ØªØ¯Ø¦. Ù…Ø³ØªØ¹Ø¯ Ù„Ù„Ø§Ø³ØªÙƒØ´Ø§ÙØŸ"
        },
        Intermediate: {
          greet: "ðŸ‘‹ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ø³ØªÙƒØ´Ù!",
          msg: "ØªØªÙ‚Ø¯Ù… Ø¨Ø´ÙƒÙ„ Ø±Ø§Ø¦Ø¹! ØªØ§Ø¨Ø¹ Ø§Ù„Ù…Ø³ÙŠØ±!"
        },
        Advanced: {
          greet: "ðŸ‘‹ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ø®Ø¨ÙŠØ±!",
          msg: "Ù„Ù‚Ø¯ Ø§Ù‚ØªØ±Ø¨Øª Ù…Ù† Ø§Ù„Ù‚Ù…Ø©. ØªØ­Ø¯Ù‰ Ù†ÙØ³Ùƒ Ø£ÙƒØ«Ø±!"
        }
      }
    };

    document.addEventListener("DOMContentLoaded", () => {
      const lang = localStorage.getItem("language") || "en";
      document.documentElement.lang = lang;
      document.body.dir = (lang === "ar" || lang === "he") ? "rtl" : "ltr";

      const container = document.getElementById("welcomeArea");

      onAuthStateChanged(auth, async (user) => {
        if (user) {
          const userDoc = await getDoc(doc(db, "users", user.uid));
          if (userDoc.exists()) {
            const data = userDoc.data();
            const level = data.level || "Beginner";
            const name = data.username || "User";
            const langMsgs = messages[lang] || messages.en;
            const content = langMsgs[level] || langMsgs["Beginner"];

            container.innerHTML = `
              <h2>${content.greet}</h2>
              <p><strong>${lang === "ar" ? "Ø§Ù„Ø§Ø³Ù…:" : "Name:"}</strong> ${name}</p>
              <p><strong>${lang === "ar" ? "Ø§Ù„Ù…Ø³ØªÙˆÙ‰:" : "Level:"}</strong> ${level}</p>
              <p>${content.msg}</p>
            `;
          }
        } else {
          window.location.href = "login.html";
        }
      });
    });
  </script>
</head>
<body>
  <main class="form-container">
    <div id="welcomeArea">...</div>
  </main>
</body>
</html>