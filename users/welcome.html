<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Welcome | KidCyclopedia</title>
  <link rel="stylesheet" href="../css/style.css">
  <script type="module">
    import { auth, db } from './firebase-config.js';
    import { onAuthStateChanged } from 'firebase/auth';
    import { doc, getDoc } from 'firebase/firestore';

    document.addEventListener("DOMContentLoaded", () => {
      const lang = localStorage.getItem("language") || "en";
      document.documentElement.lang = lang;
      document.body.dir = (lang === "ar" || lang === "he") ? "rtl" : "ltr";

      const content = document.getElementById("welcomeMessage");

      onAuthStateChanged(auth, async (user) => {
        if (user) {
          const userDoc = await getDoc(doc(db, "users", user.uid));
          if (userDoc.exists()) {
            const data = userDoc.data();
            const name = data.username || "User";
            const level = data.level || "Beginner";

            if (lang === "ar") {
              content.innerHTML = `
                <h2>ðŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ${name}</h2>
                <p>ðŸŽ“ Ù…Ø³ØªÙˆØ§Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${level}</p>
                <p>ðŸŒŸ Ø§Ø³ØªØ¹Ø¯ Ù„Ù…ØºØ§Ù…Ø±Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø±Ø§Ø¦Ø¹Ø©!</p>
              `;
            } else {
              content.innerHTML = `
                <h2>ðŸ‘‹ Welcome ${name}</h2>
                <p>ðŸŽ“ Your current level: ${level}</p>
                <p>ðŸŒŸ Get ready for an exciting learning journey!</p>
              `;
            }
          }
        } else {
          window.location.href = "login.html";
        }
      });
    });
  </script>
</head>
<body>
  <main class="form-container">
    <div id="welcomeMessage">Loading...</div>
  </main>
</body>
</html>